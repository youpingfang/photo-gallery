/* Extracted from previous server.js inline CSS. */
:root{
  --bg:#0b0e14;
  --card:#121828;
  --text:#e6e9f2;
  --muted:#9aa3b2;
  --accent:#6ea8fe;
  --r-sm: clamp(12px, 2.2vw, 18px);
  --r-md: clamp(16px, 3.0vw, 24px);
  --r-lg: clamp(18px, 3.4vw, 28px);
}
*{ box-sizing:border-box; }
body{
  margin:0;
  font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
  color:var(--text);
  background:#050611;
  overscroll-behavior:none;
  position:relative;
  min-height:100vh;
  isolation:isolate;
}
body::before{
  content:'';
  position:fixed;
  inset:-20%;
  z-index:-1;
  background:conic-gradient(
    from 180deg at 50% 50%,
    rgba(255, 0, 153, .38),
    rgba(255, 102, 0, .28),
    rgba(255, 214, 0, .26),
    rgba(0, 255, 170, .26),
    rgba(0, 170, 255, .30),
    rgba(167, 139, 250, .34),
    rgba(255, 0, 153, .38)
  );
  filter: blur(40px) saturate(1.25);
  opacity:.95;
  transform:translate3d(0,0,0);
  animation:bgSpin 22s linear infinite;
}
@keyframes bgSpin{ from{ transform:rotate(0deg);} to{ transform:rotate(360deg);} }
/* immersive: no top chrome inside page */
header{ display:none !important; }
.row{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; }
.title{ font-weight:700; letter-spacing:.2px; }
.crumbs{ display:none; }
.dirs{ display:none; }
.wrap{ padding:10px 10px 18px; max-width:none; margin:0 auto; }
body.modeCollage .wrap{ padding:0; }
html, body{ height:100%; }

/* Masonry columns */
.grid{ column-gap:3px; column-count: var(--cols,3); }
body.autoCols .grid{ column-count: 4; column-width:auto; }
@media (max-width: 900px){ body.autoCols .grid{ column-count:3; } }
@media (max-width: 680px){ body.autoCols .grid{ column-count:2; } }
@media (min-width: 1400px){ body.autoCols .grid{ column-count:5; } }

.tile{ display:block; width:100%; margin:0 0 3px; background:transparent; border:0; border-radius:var(--r-sm); overflow:hidden; cursor:pointer; break-inside:avoid; position:relative; aspect-ratio:4/5; }
.tile.r1{ aspect-ratio:1/1; }
.tile.r2{ aspect-ratio:4/5; }
.tile.r3{ aspect-ratio:3/4; }
.tile.r4{ aspect-ratio:2/3; }
.tile.r5{ aspect-ratio:9/16; }
.tile.r6{ aspect-ratio:1/2; }
.tile.ellipse, .tile.ellipse img{ border-radius:999px; }
.tile.circle, .tile.circle img{ border-radius:999px; }
.tile img{ width:100%; height:100%; object-fit:cover; display:block; background:#0f1320; position:relative; z-index:2; }

/* cyber neon vibe */
.tile::before{
  content:'';
  position:absolute;
  inset:-2px;
  border-radius:inherit;
  background:conic-gradient(
    from 180deg at 50% 50%,
    rgba(0, 255, 170, .95),
    rgba(0, 170, 255, .95),
    rgba(167, 139, 250, .95),
    rgba(255, 0, 153, .95),
    rgba(255, 214, 0, .95),
    rgba(0, 255, 170, .95)
  );
  filter: blur(10px);
  opacity:.16;
  z-index:0;
  pointer-events:none;
}
.tile::after{
  content:'';
  position:absolute;
  inset:0;
  border-radius:inherit;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,.10);
  z-index:1;
  pointer-events:none;
}
.tile:hover::before{ opacity:.26; }
.tile.edgeGlow::after{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.18), 0 0 60px rgba(110,168,254,.55), 0 0 24px rgba(255,0,153,.18); }
.tile.edgeSoft::after{ box-shadow: inset 0 0 0 2px rgba(255,255,255,.14), 0 0 48px rgba(255,255,255,.22); filter: blur(.9px); }

.tile.sel{ outline:2px solid rgba(110,168,254,.9); outline-offset:-2px; }
.tile.sel::before{ opacity:.38; }

.check{ position:absolute; top:8px; left:8px; width:26px; height:26px; border-radius:12px; background:rgba(0,0,0,.35); border:1px solid rgba(255,255,255,.18); display:none; align-items:center; justify-content:center; color:#fff; font-weight:900; z-index: 3; }
.tile.sel .check{ display:flex; }

/* action bar */
.actionBar{ position:fixed; left:14px; right:14px; bottom:16px; z-index:40; display:none; gap:10px; align-items:center; justify-content:space-between; padding:12px; background: rgba(18,24,40,.78); border:1px solid rgba(255,255,255,.10); border-radius:var(--r-md); backdrop-filter: blur(10px); }
.actionBar.show{ display:flex; }

/* buttons */
button{ background:var(--accent); border:0; color:#061225; padding:10px 12px; border-radius:var(--r-sm); cursor:pointer; font-weight:800; }
button:active{ transform: translateY(1px); }
.btnGhost{ background:rgba(255,255,255,.10); border:1px solid rgba(255,255,255,.18); color:#fff; }
.btnPrimary{ background:var(--accent); color:#061225; }
.btnDanger{ background:rgba(255, 73, 73, .92); color:#1a0303; }
.sel{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.1); color:var(--text); border-radius:10px; padding:10px 12px; }
input{ background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.12); color:var(--text); border-radius:var(--r-sm); padding:10px 12px; min-width:240px; outline:none; }

/* floating action buttons */
.fab{ position:fixed; right:14px; bottom:88px; display:flex; flex-direction:column; gap:10px; z-index:30; transition: opacity .25s ease, transform .25s ease; }
body.fabHidden .fab{ opacity:0; pointer-events:none; transform: translateY(8px); }
body.immersive .fab #settingsBtn, body.immersive .fab #uploadBtn{ display:none; }
body.immersive .fab{ left:50%; right:auto; bottom:18px; transform:translateX(-50%); }
body.immersive .fab button{ width:56px; height:56px; border-radius:var(--r-md); font-size:28px; }
.fab button{ width:44px; height:44px; padding:0; display:grid; place-items:center; border-radius:var(--r-sm); background: rgba(18,24,40,.78); border:1px solid rgba(255,255,255,.10); color:var(--text); backdrop-filter: blur(10px); font-size:24px; line-height:1; }

/* lightbox */
.lb{ position:fixed; inset:0; z-index:2147483647; background:rgba(0,0,0,.25); display:none; align-items:center; justify-content:center; padding:10px; overscroll-behavior:contain; touch-action:none; backdrop-filter: blur(10px); transform:translateZ(0); }
.lb.open{ display:flex; }
.lb-inner{ width:100%; max-width:min(1400px, 100vw); height:min(96vh, 980px); }
.lb-stage{ height:100%; display:grid; grid-template-rows: 4fr 1fr; gap:10px; min-height:0; }
.mainWrap{ position:relative; min-height:0; border-radius:var(--r-lg); overflow:hidden; background:transparent; box-shadow:0 18px 50px rgba(0,0,0,.35); padding:0; border:1px solid rgba(255,255,255,.10); }
.lb-bg{ position:absolute; inset:-18px; width:calc(100% + 36px); height:calc(100% + 36px);
  object-fit:cover; filter: blur(28px) saturate(1.15) brightness(.85);
  transform: scale(1.08); opacity:.95; }
.lb-img{ position:absolute; inset:0; width:100%; height:100%; object-fit:contain; border-radius:var(--r-lg); background:transparent; display:block; transform-origin:50% 50%; transition:transform .12s ease; will-change:transform; opacity:0; touch-action:none; }
.lb-img.isActive{ opacity: 1; }
body.immersive .lb-img{ transition: transform .12s ease, opacity .28s ease; }

.thumbs{ height:100%; min-height:64px; display:flex; align-items:center; gap:8px; overflow-x:auto; padding:8px 6px; -webkit-overflow-scrolling:touch; scrollbar-width:none; background:rgba(0,0,0,.18); border:1px solid rgba(255,255,255,.08); border-radius:14px; touch-action: pan-x; }
.immersive .thumbs{ display:none; }
.immersive .lb-stage{ grid-template-rows: 1fr; }
.thumbs::-webkit-scrollbar{ display:none; }
.thumb{ flex:0 0 auto; width:92px; height:64px; border-radius:var(--r-sm); overflow:hidden; border:1px solid rgba(255,255,255,.14); background:rgba(255,255,255,.06); cursor:pointer; transform: translateZ(0); transition: transform .14s ease, box-shadow .14s ease, border-color .14s ease, filter .14s ease; }
.thumb img{ width:100%; height:100%; object-fit:cover; display:block; pointer-events:none; }
.thumb.active{ border-color: rgba(110,168,254,.98); transform: translateY(-12px) scale(1.12); box-shadow: 0 26px 46px rgba(0,0,0,.60), 0 0 0 3px rgba(110,168,254,.26), 0 0 44px rgba(110,168,254,.32); filter: saturate(1.18) contrast(1.06); }

.lbX,.lbPrev,.lbNext{ position:absolute; top:12px; background:rgba(0,0,0,.42); border:1px solid rgba(255,255,255,.22); color:#fff; border-radius:var(--r-sm); width:44px; height:44px; padding:0; cursor:pointer; font-size:24px; line-height:1; display:grid; place-items:center; }
.lbX{ right:12px; }
.lbPrev{ left:12px; top:50%; transform:translateY(-50%); }
.lbNext{ right:12px; top:50%; transform:translateY(-50%); }

.hint{ position:absolute; padding:8px 10px; border-radius:12px; background:rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.18); color:#fff; font-weight:800; font-size:12px; letter-spacing:.2px; backdrop-filter: blur(8px); pointer-events:none; opacity:0; transform: translateY(6px); }
.hint.show{ opacity:1; transform: translateY(0); transition: opacity .25s ease, transform .25s ease; }
.hint.fade{ opacity:0; transform: translateY(10px); transition: opacity .6s ease, transform .6s ease; }

/* autoplay progress */
#apProg{ position:fixed; left:12px; right:12px; bottom:12px; height:3px; border-radius:999px; background: rgba(255,255,255,.14); overflow:hidden; display:none; z-index:2147483647; }
body.immersive #apProg{ display:block; }
#apProgBar{ height:100%; width:0%; border-radius:999px; background: linear-gradient(90deg, rgba(0,255,170,.95), rgba(0,170,255,.95), rgba(167,139,250,.95), rgba(255,0,153,.95)); box-shadow: 0 0 18px rgba(110,168,254,.35); will-change: width; }

#lbMeta{ position:fixed; left:12px; right:12px; bottom:20px; padding:10px 12px; border-radius:14px; background:rgba(0,0,0,.30); border:1px solid rgba(255,255,255,.10); color:rgba(255,255,255,.85); font-size:12px; line-height:1.25; backdrop-filter: blur(10px); z-index:2147483647; pointer-events:none; transform: translateY(8px); opacity:0; transition: opacity .18s ease, transform .18s ease;
  /* avoid single-line truncation on long places */
  display:-webkit-box;
  -webkit-line-clamp:2;
  -webkit-box-orient:vertical;
  overflow:hidden;
}
#lbMeta.show{ opacity:1; transform: translateY(0); }
body.immersive #lbMeta{ display:block; }

/* settings card */
.settingsCard{ background:var(--card); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:14px; }
.setSection{ margin-top:14px; padding-top:12px; border-top:1px solid rgba(255,255,255,.08); }
.setTitle{ font-weight:900; letter-spacing:.2px; margin-bottom:10px; }
.setRow{ display:flex; align-items:center; justify-content:space-between; gap:12px; margin-top:10px; }
.setLabel{ color:rgba(255,255,255,.72); font-size:13px; min-width:72px; }
.setHelp{ color:rgba(255,255,255,.55); font-size:12px; line-height:1.25; }
.setFooter{ display:flex; gap:10px; justify-content:flex-end; align-items:center; margin-top:16px; padding-top:12px; border-top:1px solid rgba(255,255,255,.08); }

/* bubble stage */
.bubbleStage{ position:relative; width:100%; height:min(92vh, 1200px); border-radius:var(--r-lg); border:0; background:transparent; overflow:hidden; box-shadow:none; }
.bubbleTile{ position:absolute; left:0; top:0; width:160px; height:200px; border-radius:var(--r-sm); overflow:hidden; border:0; background: rgba(255,255,255,.04); box-shadow:0 12px 34px rgba(0,0,0,.28); }
.bubbleTile img{ width:100%; height:100%; object-fit:cover; display:block; border-radius:inherit; position:relative; z-index:2; }
.bubbleTile::before{ content:''; position:absolute; inset:-2px; border-radius:inherit; background:conic-gradient(from 180deg at 50% 50%, rgba(0,255,170,.95), rgba(0,170,255,.95), rgba(167,139,250,.95), rgba(255,0,153,.95), rgba(255,214,0,.95), rgba(0,255,170,.95)); filter: blur(12px); opacity:.20; z-index:0; pointer-events:none; }
.bubbleTile::after{ content:''; position:absolute; inset:0; border-radius:inherit; box-shadow: inset 0 0 0 1px rgba(255,255,255,.10); z-index:1; pointer-events:none; }
.bubbleTile.circle, .bubbleTile.circle img{ border-radius:999px !important; }
.bubbleTile.ellipse, .bubbleTile.ellipse img{ border-radius:999px !important; }

/* collage mode */
.collage{ display:grid; grid-template-columns: repeat(3, 1fr); gap:10px; padding:10px; }
.collage .cTile{ position:relative; overflow:hidden; border-radius:var(--r-md); background: rgba(255,255,255,.06); }
.collage .cTile.circle{ border-radius:999px; }
.collage .cTile.circle .cImg{ border-radius:999px; }
.collage .cTile .cImg{ position:absolute; inset:0; width:100%; height:100%; object-fit:cover; display:block; opacity:0; transition: opacity .65s ease; background:transparent; }
.collage .cTile .cImg.on{ opacity:1; }

/* collage template uses grid areas (mobile + desktop define grid-template-areas) */
.collage{ grid-auto-flow: dense; }
.collage .c1{ grid-area:c1; }
.collage .c2{ grid-area:c2; }
.collage .c3{ grid-area:c3; }
.collage .c4{ grid-area:c4; }
.collage .c5{ grid-area:c5; }
.collage .c6{ grid-area:c6; }
.collage .c7{ grid-area:c7; }
.collage .c8{ grid-area:c8; }
.collage .c9{ grid-area:c9; }
.collage .c10{ grid-area:c10; }

@media (min-width: 900px){
  .bubbleStage{ height: 100vh; border-radius:0; border:0; box-shadow:none; background:transparent; }
  .wrap{ padding-left:0; padding-right:0; padding-bottom:0; }

  /* desktop collage: wide / no blank margins / no overlap */
  .collage{
    width:100%;
    height:100vh;
    margin:0;
    padding:12px;
    padding-bottom: calc(12px + env(safe-area-inset-bottom));
    box-sizing:border-box;
    gap:10px;
    grid-template-columns: repeat(5, 1fr);
    grid-template-rows: repeat(4, minmax(0, 1fr));
    grid-template-areas:
      "c1 c1 c2 c3 c4"
      "c1 c1 c5 c3 c4"
      "c6 c7 c8 c9 c10"
      "c6 c7 c8 c9 c10";
  }

  /* area mapping moved to global */
}

@media (max-width: 520px){
  input{ min-width:180px; width:100%; }
  /* mobile: make tiles larger; keep user-selected column count */
  .grid{ column-gap: 6px; }
  .tile{ margin-bottom: 6px; }

  /* mobile collage: balanced mosaic (avoid big blanks) */
  .collage{
    width:100%;
    /* Prefer dvh (dynamic viewport) to reduce bottom blank on mobile browsers */
    height:100dvh;
    height:100svh;
    margin:0;
    /* keep top/bottom padding symmetric for nicer look */
    padding:10px;
    padding-top: calc(10px + env(safe-area-inset-top));
    padding-bottom: calc(10px + env(safe-area-inset-bottom));
    box-sizing:border-box;
    gap:10px;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(6, minmax(0, 1fr));
    grid-template-areas:
      "c1 c1 c2"
      "c1 c1 c3"
      "c4 c5 c3"
      "c6 c5 c7"
      "c6 c8 c9"
      "c10 c8 c9";
  }
  /* disable aspect-ratio constraints on mobile to avoid weird gaps */
  .collage .c1,.collage .c2,.collage .c3,.collage .c4,.collage .c5,.collage .c6,.collage .c7,.collage .c8,.collage .c9,.collage .c10{
    aspect-ratio: auto !important;
  }
}

services:
  gallery:
    build: .
    container_name: image-gallery
    ports:
      - "6789:3000"
    environment:
      - PORT=3000
      - IMAGES_DIR=/images

      # 管理解锁（用于配置数据源/相册等管理操作）
      - ADMIN_PASS=${ADMIN_PASS}

      # 上传/删除等管理操作已统一由 ADMIN_PASS 解锁（cookie）控制

      # Immich（方式一：作为远程数据源）
      - IMMICH_URL=${IMMICH_URL}
      - IMMICH_API_KEY=${IMMICH_API_KEY}

      # WebDAV 已移除

      # 公共相册配置文件（建议写入独立持久化目录 /data）
      - GALLERY_CONFIG_PATH=${GALLERY_CONFIG_PATH}

      # 缩略图参数（可选）
      - THUMB_WIDTH=${THUMB_WIDTH}
      - THUMB_QUALITY=${THUMB_QUALITY}

    volumes:
      # 把宿主机图片目录挂载到容器 /images
      - "${IMAGE_DIR_HOST}:/images"
      # 把宿主机数据目录挂载到容器 /data（用于保存公开相册配置等）
      - "${DATA_DIR_HOST}:/data"
    restart: unless-stopped
